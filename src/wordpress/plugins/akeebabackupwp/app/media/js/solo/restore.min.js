if("undefined"==typeof akeeba)var akeeba={};"undefined"==typeof akeeba.Restore&&(akeeba.Restore={lastResponseSeconds:0,timer:0,errorCallback:null,statistics:{inbytes:0,outbytes:0,files:0},factory:null}),akeeba.Restore.errorCallbackDefault=function(a){document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-error").style.display="block",document.getElementById("backup-error-message").innerHTML=a},akeeba.Restore.doAjax=function(a,b,c){json=JSON.stringify(a);var d={json:json},e=akeeba.System.getOptions("akeeba.Restore.password","");0<e.length&&(d.password=e);var f=new Date().getTime()/1e3,g=parseInt(f,10);d._cacheBustingJunk=Math.round(1e3*(f-g));var h={type:"POST",url:akeeba.System.getOptions("akeeba.Restore.ajaxURL",""),cache:!1,data:d,timeout:6e5,success:function success(a){var d=null,e="",f=a.indexOf("###");if(-1==f)return a="Invalid AJAX data: "+a,void(null==c?null==akeeba.Restore.errorCallback?akeeba.Restore.errorCallbackDefault(a):akeeba.Restore.errorCallback(a):c(a));0==f?e=a:(d=a.substr(0,f),e=a.substr(f));e=e.substr(3),f=e.lastIndexOf("###"),e=e.substr(0,f);try{var g=JSON.parse(e)}catch(a){return errorMessage=a.message+"\n<br/>\n<pre>\n"+e+"\n</pre>",void(null==c?null==akeeba.Restore.errorCallback?akeeba.Restore.errorCallbackDefault(errorMessage):akeeba.Restore.errorCallback(errorMessage):c(errorMessage))}b(g)},error:function error(a,b){var d=a.responseText?a.responseText:"",e="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+a.status+" ("+a.statusText+")<br/>";e=e+"Internal status: "+b+"<br/>",e=e+"XHR ReadyState: "+a.readyState+"<br/>",e=e+"Raw server response:<br/>"+akeeba.System.sanitizeErrorMessage(d),null==c?null==akeeba.Restore.errorCallback?akeeba.Restore.errorCallbackDefault(e):akeeba.Restore.errorCallback(e):c(e)}};akeeba.Ajax.ajax(h)},akeeba.Restore.startTimeoutBar=function(){akeeba.Restore.resetTimeoutBar(),akeeba.Restore.timer=setInterval(function(){akeeba.Restore.lastResponseSeconds++;var a=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s",akeeba.Restore.lastResponseSeconds.toFixed(0));try{document.getElementById("response-timer").querySelector("div.text").textContent=a}catch(a){}},1e3)},akeeba.Restore.resetTimeoutBar=function(){if(akeeba.Restore.lastResponseSeconds=0,0!=akeeba.Restore.timer){clearInterval(akeeba.Restore.timer),akeeba.Restore.timer=0;var a=document.getElementById("response-timer").querySelector("div.text"),b=akeeba.System.Text._("COM_AKEEBA_BACKUP_TEXT_LASTRESPONSE").replace("%s","0");try{a.textContent=b}catch(a){}}},akeeba.Restore.pingRestoration=function(){akeeba.Restore.statistics.inbytes=0,akeeba.Restore.statistics.outbytes=0,akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5e3,80),akeeba.Restore.doAjax({task:"ping"},function(a){akeeba.Restore.start(a)})},akeeba.Restore.start=function(){akeeba.Restore.statistics.inbytes=0,akeeba.Restore.statistics.outbytes=0,akeeba.Restore.statistics.files=0;akeeba.Restore.startTimeoutBar(5e3,80),akeeba.Restore.doAjax({task:"startRestore"},function(a){akeeba.Restore.step(a)})},akeeba.Restore.step=function(a){if(akeeba.Restore.resetTimeoutBar(),!1==a.status)akeeba.Restore.errorCallbackDefault(a.message);else if(a.done)akeeba.Restore.factory=a.factory,document.getElementById("restoration-progress").style.display="none",document.getElementById("restoration-extract-ok").style.display="block";else{akeeba.Restore.statistics.inbytes+=a.bytesIn,akeeba.Restore.statistics.outbytes+=a.bytesOut,akeeba.Restore.statistics.files+=a.files;try{document.getElementById("extbytesin").textContent=akeeba.Restore.statistics.inbytes,document.getElementById("extbytesout").textContent=akeeba.Restore.statistics.outbytes,document.getElementById("extfiles").textContent=akeeba.Restore.statistics.files}catch(a){}post={task:"stepRestore",factory:a.factory},akeeba.Restore.startTimeoutBar(5e3,80),akeeba.Restore.doAjax(post,function(a){akeeba.Restore.step(a)})}},akeeba.Restore.finalize=function(a){a.preventDefault();var b={task:"finalizeRestore",factory:akeeba.Restore.factory};return akeeba.Restore.startTimeoutBar(5e3,80),akeeba.Restore.doAjax(b,function(a){akeeba.Restore.finished(a)}),!1},akeeba.Restore.finished=function(){window.location=akeeba.System.getOptions("akeeba.Restore.mainURL",window.location)},akeeba.Restore.runInstaller=function(a){a.preventDefault();var b=akeeba.System.getOptions("akeeba.Restore.mainURL","");window.open(b+"/installation/index.php","abiinstaller");var c=document.getElementById("restoration-runinstaller"),d=document.getElementById("restoration-finalize");return c.className="akeeba-btn--grey--small",d.style.display="block",!1},akeeba.Restore.restoreDefaultOptions=function(){var a=document.getElementById("jps_key");a&&(a.value="ChromeIsDumb",a.value="")},akeeba.Restore.onProcEngineChange=function(){var a=document.getElementById("procengine");"direct"===a.options[a.selectedIndex].value?(document.getElementById("ftpOptions").style.display="none",document.getElementById("testftp").style.display="none"):(document.getElementById("ftpOptions").style.display="block",document.getElementById("testftp").style.display="inline-block")},akeeba.System.documentReady(function(){akeeba.System.getOptions("akeeba.Restore.inMainRestoration",!1)?(akeeba.System.addEventListener(document.getElementById("restoration-runinstaller"),"click",akeeba.Restore.runInstaller),akeeba.System.addEventListener(document.getElementById("restoration-finalize"),"click",akeeba.Restore.finalize),akeeba.Restore.pingRestoration()):(akeeba.System.addEventListener("backup-start","click",function(a){return a.preventDefault(),document.adminForm.submit(),!1}),akeeba.System.addEventListener("ftp-browse","click",function(a){return a.preventDefault(),akeeba.Configuration.FtpBrowser.initialise("ftp.initial_directory","ftp"),!1}),akeeba.System.addEventListener("testftp","click",function(a){return a.preventDefault(),akeeba.Configuration.FtpTest.testConnection("testftp","ftp"),!1}),akeeba.System.addEventListener("procengine","change",akeeba.Restore.onProcEngineChange),akeeba.Restore.onProcEngineChange(),setTimeout(akeeba.Restore.restoreDefaultOptions,500))});

//# sourceMappingURL=restore.min.js.map